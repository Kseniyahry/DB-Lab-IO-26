# Реалізація інформаційного та програмного забезпечення

В рамках проєкту розробляється:
## SQL-скрипт для створення на початкового наповнення бази даних

```sql
-- MySQL Script generated by MySQL Workbench
-- Mon Apr 29 21:15:10 2024
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema DB-lab-IO-26
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema DB-lab-IO-26
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `DB-lab-IO-26` DEFAULT CHARACTER SET utf8 ;
USE `DB-lab-IO-26` ;

-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`permissions`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`permissions` (
  `Id` INT NOT NULL,
  `Permission` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`Id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`projects`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`projects` (
  `Id` INT NOT NULL,
  `Name` VARCHAR(50) NOT NULL,
  `Description` VARCHAR(100) NOT NULL,
  `Status` VARCHAR(20) NOT NULL,
  PRIMARY KEY (`Id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`payments`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`payments` (
  `Id` INT NOT NULL,
  `CardNumber` INT NOT NULL,
  `CardCVV` INT NOT NULL,
  `CardExpireDate` DATETIME NOT NULL,
  `Email` VARCHAR(50) NOT NULL,
  `ProjectId` INT NOT NULL,
  PRIMARY KEY (`Id`),
  INDEX `fk_payments_projects_idx` (`ProjectId` ASC) VISIBLE,
  CONSTRAINT `fk_payments_projects`
    FOREIGN KEY (`ProjectId`)
    REFERENCES `DB-lab-IO-26`.`projects` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`reles`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`reles` (
  `Id` INT NOT NULL,
  `Name` VARCHAR(30) NULL,
  PRIMARY KEY (`Id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`role_grant`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`role_grant` (
  `RoleID` INT NOT NULL,
  `PermissionId` INT NOT NULL,
  INDEX `fk_role_grant_reles1_idx` (`RoleID` ASC) VISIBLE,
  INDEX `fk_role_grant_permissions1_idx` (`PermissionId` ASC) VISIBLE,
  CONSTRAINT `fk_role_grant_reles1`
    FOREIGN KEY (`RoleID`)
    REFERENCES `DB-lab-IO-26`.`reles` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_role_grant_permissions1`
    FOREIGN KEY (`PermissionId`)
    REFERENCES `DB-lab-IO-26`.`permissions` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`reviews`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`reviews` (
  `Id` INT NOT NULL,
  `Text` VARCHAR(100) NOT NULL,
  `Rate` INT NOT NULL,
  `ProjectId` INT NOT NULL,
  PRIMARY KEY (`Id`),
  INDEX `fk_reviews_projects1_idx` (`ProjectId` ASC) VISIBLE,
  CONSTRAINT `fk_reviews_projects1`
    FOREIGN KEY (`ProjectId`)
    REFERENCES `DB-lab-IO-26`.`projects` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`tasks`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`tasks` (
  `Id` INT NOT NULL,
  `Name` VARCHAR(50) NOT NULL,
  `Developer` VARCHAR(45) NOT NULL,
  `Status` VARCHAR(20) NOT NULL,
  `Deadline` DATETIME NOT NULL,
  `ProjectId` INT NOT NULL,
  PRIMARY KEY (`Id`),
  INDEX `fk_tasks_projects1_idx` (`ProjectId` ASC) VISIBLE,
  CONSTRAINT `fk_tasks_projects1`
    FOREIGN KEY (`ProjectId`)
    REFERENCES `DB-lab-IO-26`.`projects` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`users`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`users` (
  `Id` INT NOT NULL,
  `Login` VARCHAR(45) NOT NULL,
  `Picture` MEDIUMBLOB NOT NULL,
  `Password` BLOB NOT NULL,
  `Email` VARCHAR(50) NOT NULL,
  `Role` VARCHAR(30) NOT NULL,
  PRIMARY KEY (`Id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`members`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`members` (
  `Id` INT NOT NULL,
  `RoleId` INT NOT NULL,
  `UserId` INT NOT NULL,
  PRIMARY KEY (`Id`),
  INDEX `fk_members_users1_idx` (`RoleId` ASC) VISIBLE,
  INDEX `fk_members_reles1_idx` (`UserId` ASC) VISIBLE,
  CONSTRAINT `fk_members_users1`
    FOREIGN KEY (`RoleId`)
    REFERENCES `DB-lab-IO-26`.`users` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_members_reles1`
    FOREIGN KEY (`UserId`)
    REFERENCES `DB-lab-IO-26`.`reles` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `DB-lab-IO-26`.`projects_members`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `DB-lab-IO-26`.`projects_members` (
  `MemberID` INT NOT NULL,
  `ProjectId` INT NOT NULL,
  INDEX `fk_projects_members_projects1_idx` (`MemberID` ASC) VISIBLE,
  INDEX `fk_projects_members_members1_idx` (`ProjectId` ASC) VISIBLE,
  CONSTRAINT `fk_projects_members_projects1`
    FOREIGN KEY (`MemberID`)
    REFERENCES `DB-lab-IO-26`.`projects` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_projects_members_members1`
    FOREIGN KEY (`ProjectId`)
    REFERENCES `DB-lab-IO-26`.`members` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`permissions`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`permissions` (`Id`, `Permission`) VALUES (1, 'Read');
INSERT INTO `DB-lab-IO-26`.`permissions` (`Id`, `Permission`) VALUES (2, 'Write');
INSERT INTO `DB-lab-IO-26`.`permissions` (`Id`, `Permission`) VALUES (3, 'Execute');

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`projects`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`projects` (`Id`, `Name`, `Description`, `Status`) VALUES (1, 'Project A', 'Description for Project A', 'Active');
INSERT INTO `DB-lab-IO-26`.`projects` (`Id`, `Name`, `Description`, `Status`) VALUES (2, 'Project B', 'Description for Project B', 'Inactive');
INSERT INTO `DB-lab-IO-26`.`projects` (`Id`, `Name`, `Description`, `Status`) VALUES (3, 'Project C', 'Description for Project C', 'Pending');

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`payments`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`payments` (`Id`, `CardNumber`, `CardCVV`, `CardExpireDate`, `Email`, `ProjectId`) VALUES (1, 123456, 123, '2024-04-26', 'payment1@example.com', 1);
INSERT INTO `DB-lab-IO-26`.`payments` (`Id`, `CardNumber`, `CardCVV`, `CardExpireDate`, `Email`, `ProjectId`) VALUES (2, 112233, 456, '2024-04-27', 'payment2@example.com', 2);
INSERT INTO `DB-lab-IO-26`.`payments` (`Id`, `CardNumber`, `CardCVV`, `CardExpireDate`, `Email`, `ProjectId`) VALUES (3, 123424, 789, '2024-04-29', 'payment3@example.com', 3);

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`reles`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`reles` (`Id`, `Name`) VALUES (1, 'Teamlead');
INSERT INTO `DB-lab-IO-26`.`reles` (`Id`, `Name`) VALUES (2, 'Developer');
INSERT INTO `DB-lab-IO-26`.`reles` (`Id`, `Name`) VALUES (3, 'Admin');

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`role_grant`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`role_grant` (`RoleID`, `PermissionId`) VALUES (1, 1);
INSERT INTO `DB-lab-IO-26`.`role_grant` (`RoleID`, `PermissionId`) VALUES (1, 2);
INSERT INTO `DB-lab-IO-26`.`role_grant` (`RoleID`, `PermissionId`) VALUES (2, 1);
INSERT INTO `DB-lab-IO-26`.`role_grant` (`RoleID`, `PermissionId`) VALUES (2, 3);
INSERT INTO `DB-lab-IO-26`.`role_grant` (`RoleID`, `PermissionId`) VALUES (3, 2);
INSERT INTO `DB-lab-IO-26`.`role_grant` (`RoleID`, `PermissionId`) VALUES (3, 3);

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`reviews`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`reviews` (`Id`, `Text`, `Rate`, `ProjectId`) VALUES (1, 'Good project!', 5, 1);
INSERT INTO `DB-lab-IO-26`.`reviews` (`Id`, `Text`, `Rate`, `ProjectId`) VALUES (2, 'Could be better', 3, 2);
INSERT INTO `DB-lab-IO-26`.`reviews` (`Id`, `Text`, `Rate`, `ProjectId`) VALUES (3, 'Excellent work', 5, 3);

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`tasks`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`tasks` (`Id`, `Name`, `Developer`, `Status`, `Deadline`, `ProjectId`) VALUES (1, 'Task 1', 'dev_user1', 'In Progress', '2024-04-25', 1);
INSERT INTO `DB-lab-IO-26`.`tasks` (`Id`, `Name`, `Developer`, `Status`, `Deadline`, `ProjectId`) VALUES (2, 'Task 2', 'dev_user2', 'To Do', '2024-04-28', 2);
INSERT INTO `DB-lab-IO-26`.`tasks` (`Id`, `Name`, `Developer`, `Status`, `Deadline`, `ProjectId`) VALUES (3, 'Task 3', 'dev_user3', 'Completed', '2024-04-29', 3);

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`users`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`users` (`Id`, `Login`, `Picture`, `Password`, `Email`, `Role`) VALUES (1, 'admin_user', admin_picture_blob, admin_password_blob, 'admin@example.com', 'Teamlead');
INSERT INTO `DB-lab-IO-26`.`users` (`Id`, `Login`, `Picture`, `Password`, `Email`, `Role`) VALUES (2, 'dev_user1', dev_picture_blob1, dev_password_blob1, 'dev1@example.com', 'Developer');
INSERT INTO `DB-lab-IO-26`.`users` (`Id`, `Login`, `Picture`, `Password`, `Email`, `Role`) VALUES (3, 'dev_user2', dev_picture_blob2, dev_password_blob2, 'dev2@example.com', 'Developer');
INSERT INTO `DB-lab-IO-26`.`users` (`Id`, `Login`, `Picture`, `Password`, `Email`, `Role`) VALUES (4, 'manager_user', manager_picture_blob, manager_password_blob, 'manager@example.com', 'Admin');

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`members`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`members` (`Id`, `RoleId`, `UserId`) VALUES (1, 1, 1);
INSERT INTO `DB-lab-IO-26`.`members` (`Id`, `RoleId`, `UserId`) VALUES (2, 2, 2);
INSERT INTO `DB-lab-IO-26`.`members` (`Id`, `RoleId`, `UserId`) VALUES (3, 2, 3);
INSERT INTO `DB-lab-IO-26`.`members` (`Id`, `RoleId`, `UserId`) VALUES (4, 3, 4);

COMMIT;


-- -----------------------------------------------------
-- Data for table `DB-lab-IO-26`.`projects_members`
-- -----------------------------------------------------
START TRANSACTION;
USE `DB-lab-IO-26`;
INSERT INTO `DB-lab-IO-26`.`projects_members` (`MemberID`, `ProjectId`) VALUES (1, 1);
INSERT INTO `DB-lab-IO-26`.`projects_members` (`MemberID`, `ProjectId`) VALUES (2, 1);
INSERT INTO `DB-lab-IO-26`.`projects_members` (`MemberID`, `ProjectId`) VALUES (3, 2);
INSERT INTO `DB-lab-IO-26`.`projects_members` (`MemberID`, `ProjectId`) VALUES (4, 3);

COMMIT;

```
## Базовий клас з методами присутніми для управління даними таблиці з тасками
```js
const db = require("../database");

class Task {
  static async getAll() {
    const sql = `
        SELECT * 
        FROM tasks;
        `;
    let connection;
    try {
      connection = await db.promisePool.getConnection();
      const tasks = await connection.execute(sql);
      return tasks[0];
    } catch (err) {
      console.error(err);
    } finally {
      if (connection) {
        await connection.release();
      }
    }
  }

  static async getTaskByID(id) {
    const sql = `SELECT * FROM tasks WHERE id = ${id};`;
    let connection;
    try {
      connection = await db.promisePool.getConnection();
      const [res] = await connection.query(sql);
      return res;
    } catch (err) {
      console.error(err);
    } finally {
      if (connection) {
        await connection.release();
      }
    }
  }
  
  static async updateTaskById(id,{ name, developer, status, deadline, projectId}) {
    const sql = `
        UPDATE DB-lab-IO-26.tasks
        SET 
          Name = ?,
          Developer = ?,
          Status = ?,
          Deadline = ?,
		  ProjectId = ?,
        WHERE Id = ?;
    `;

    let connection;
    try {
      connection = await db.promisePool.getConnection();
      await connection.beginTransaction();
      await connection.execute(sql, [
        name,
        developer,
        status,
        deadline,
        projectId,
        id,
      ]);
      await connection.commit();
      return Task.getTaskByID(id);
    } catch (err) {
      await connection.rollback();
      console.log(err);
    } finally {
      if (connection) {
        await connection.release();
      }
    }
  }

  static async createTask({ name, developer, status, deadline, projectId}) {
    const sql = `
        INSERT INTO DB-lab-IO-26.tasks (name, developer, status, deadline, projectId)
        VALUES ( ?, ?, ?, ?, ?);
        `;
    let connection;
    try {
      connection = await db.promisePool.getConnection();
      const [res] = await connection.execute(sql, [
        name,
        developer,
        status,
        deadline,
		projectId,
      ]);
      const createdTaskId = res.insertId;
      console.log(`Task with ID ${createdTaskId} created successfully.`);
      return Task.getTaskByID(createdTaskId);
    } catch (err) {
      console.error(err);
    } finally {
      if (connection) {
        await connection.release();
      }
    }
  }

  static async deleteTaskById(id) {
    const task = await Task.getTaskByID(id);
    const deleteTaskSql = `DELETE FROM DB-lab-IO-26.tasks WHERE id = ${id}`;

    let connection;

    try {
      connection = await db.promisePool.getConnection();
      await connection.beginTransaction();
      await connection.execute(deleteTaskSql);
      await connection.commit();
      return task;
    } catch (err) {
      console.log(err);
      await connection.rollback();
      throw err;
    } finally {
      if (connection) {
        await connection.release();
      }
    }
  }
}

module.exports = { Task };

```
## Контролер тасков
```js

"use strict";

const { Task } = require("../models/Tasks.js");

const asyncWrapper = (callback) => {
  return async function (req, res) {
    const args = [];
    try {
      if (req.params.id) {
        args.push(req.params.id);
      }
      if (req.body) {
        args.push(req.body);
      }
      const result = await callback(...args);
      if (result.length) {
        res.status(200).json({ result });
      } else {
        res.status(404).json({ errorMessage: "No such task" });
      }
    } catch (err) {
      console.error(err);
      res.status(404).json({ errorMessage: err.message });
    }
  };
};

const getAllTasks = asyncWrapper(Task.getAll);
const getTaskById = asyncWrapper(Task.getTaskByID);
const createTask = asyncWrapper(Task.createTask);
const updateTask = asyncWrapper(Task.updateTaskById);
const deleteTask = asyncWrapper(Task.deleteTaskById);

module.exports = {
  getAllTasks,
  getTaskById,
  createTask,
  updateTask,
  deleteTask,
};

```
## CRUD для тасков
```js

"use strict";

const express = require("express");
const TaskController = require("../controllers/TaskController");
const router = new express.Router();
router
  .route("/")
  .get(TaskController.getAllTasks)
  .post(TaskController.createTask);

router
  .route("/:id")
  .get(TaskController.getTaskById)
  .patch(TaskController.updateTask)
  .delete(TaskController.deleteTask);

module.exports = router;

```
## RESTfull сервіс для управління даними
